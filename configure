#!/bin/bash

#
# Simple configure script to fit with the xrd-installer system.
#
# by Dario Berzano <dario.berzano@gmail.com>
#

export ROOTSYS=""
export PREFIX="/"
export MAKEOUT="`dirname $0`/Makefile.vars"

echo "# Auto-generated by configure script on `date +'%Y-%m-%d %H:%M:%S'`" > \
  "$MAKEOUT"

while [ $# -gt 0 ]; do
  case $1 in

    --help)
      echo "Parameters:"
      echo "  --prefix=<prefix>  the installation prefix (default=$PREFIX)"
      echo "  --with-rootsys     the directory of ROOT (default=auto)"
      exit 1
    ;;

    --prefix=*)
      PREFIX=${1:9}
    ;;

    --with-rootsys=*)
      ROOTSYS=${1:15}
    ;;

    *)
      echo "Unknown parameter: $1" >&2
      exit 2
    ;;

  esac
  shift
done

#
# ROOT
#

echo -n "Searching for ROOT installation..."

if [ "$ROOTSYS" == "" ]; then

  # Try to find ROOT automatically on the whole system
  ROOTEXE="root.exe"

  which locate > /dev/null 2>&1
  if [ $? == 0 ]; then
    ROOTSYS=`locate "$ROOTEXE" 2> /dev/null | head -n1`Â 
  fi

  # If locate failed, let's try with find (veeery slow)
  if [ "$ROOTSYS" == "" ]; then
    ROOTSYS=`find / -name "$ROOTEXE" -print -quit 2> /dev/null`
  fi

  if [ "$ROOTSYS" != "" ]; then
    ROOTSYS=`dirname $ROOTSYS`
    ROOTSYS=`dirname $ROOTSYS`
  fi

fi

if [ -e "$ROOTSYS/bin/$ROOTEXE" ]; then
  echo "found: $ROOTSYS"
  echo "export ROOTSYS = $ROOTSYS" >> "$MAKEOUT"
else
  echo "failed, specify a path with --with-rootsys=<dir_of_root>"
  exit 3
fi

#
# Installation prefix
#

echo "Installation prefix: $PREFIX"
echo "export PREFIX = $PREFIX" >> "$MAKEOUT"

exit 0
